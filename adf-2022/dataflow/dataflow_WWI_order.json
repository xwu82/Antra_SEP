{
	"name": "dataflow_WWI_order",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SalesOrdersCSV",
						"type": "DatasetReference"
					},
					"name": "SalesOrders"
				},
				{
					"dataset": {
						"referenceName": "SalesCustomersCSV",
						"type": "DatasetReference"
					},
					"name": "SalesCustomers"
				},
				{
					"dataset": {
						"referenceName": "SalesOrderLinesCSV",
						"type": "DatasetReference"
					},
					"name": "SalesOrderLines"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlTable1",
						"type": "DatasetReference"
					},
					"name": "DIMorder"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "WWI_output",
						"type": "DatasetReference"
					},
					"name": "STGorder"
				}
			],
			"transformations": [
				{
					"name": "select1"
				},
				{
					"name": "select2"
				},
				{
					"name": "join1"
				},
				{
					"name": "select3"
				},
				{
					"name": "join2"
				},
				{
					"name": "select4"
				}
			],
			"scriptLines": [
				"source(output(",
				"          OrderID as integer,",
				"          CustomerID as integer,",
				"          SalespersonPersonID as integer,",
				"          PickedByPersonID as string,",
				"          ContactPersonID as integer,",
				"          BackorderOrderID as string,",
				"          OrderDate as date,",
				"          ExpectedDeliveryDate as date,",
				"          CustomerPurchaseOrderNumber as integer,",
				"          IsUndersupplyBackordered as integer,",
				"          Comments as string,",
				"          DeliveryInstructions as string,",
				"          InternalComments as string,",
				"          PickingCompletedWhen as string,",
				"          LastEditedBy as integer,",
				"          LastEditedWhen as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> SalesOrders",
				"source(output(",
				"          CustomerID as integer,",
				"          CustomerName as string,",
				"          BillToCustomerID as integer,",
				"          CustomerCategoryID as integer,",
				"          BuyingGroupID as string,",
				"          PrimaryContactPersonID as integer,",
				"          AlternateContactPersonID as string,",
				"          DeliveryMethodID as integer,",
				"          DeliveryCityID as integer,",
				"          PostalCityID as integer,",
				"          CreditLimit as string,",
				"          AccountOpenedDate as date,",
				"          StandardDiscountPercentage as double,",
				"          IsStatementSent as integer,",
				"          IsOnCreditHold as integer,",
				"          PaymentDays as integer,",
				"          PhoneNumber as string,",
				"          FaxNumber as string,",
				"          DeliveryRun as string,",
				"          RunPosition as string,",
				"          WebsiteURL as string,",
				"          DeliveryAddressLine1 as string,",
				"          DeliveryAddressLine2 as string,",
				"          DeliveryPostalCode as integer,",
				"          DeliveryLocation as string,",
				"          PostalAddressLine1 as string,",
				"          PostalAddressLine2 as string,",
				"          PostalPostalCode as integer,",
				"          LastEditedBy as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> SalesCustomers",
				"source(output(",
				"          OrderLineID as integer,",
				"          OrderID as integer,",
				"          StockItemID as integer,",
				"          Description as string,",
				"          PackageTypeID as integer,",
				"          Quantity as integer,",
				"          UnitPrice as double,",
				"          TaxRate as double,",
				"          PickedQuantity as integer,",
				"          PickingCompletedWhen as string,",
				"          LastEditedBy as integer,",
				"          LastEditedWhen as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> SalesOrderLines",
				"source(output(",
				"          Order_Key as integer,",
				"          OrderID as integer,",
				"          CustomerID as integer,",
				"          SalespersonPersonID as integer,",
				"          PickedByPersonID as string,",
				"          ContactPersonID as integer,",
				"          BackorderOrderID as string,",
				"          OrderDate as date,",
				"          ExpectedDeliveryDate as date,",
				"          CustomerPurchaseOrderNumber as integer,",
				"          IsUndersupplyBackordered as integer,",
				"          Comments as string,",
				"          DeliveryInstructions as string,",
				"          InternalComments as string,",
				"          PickingCompletedWhen as string,",
				"          LastEditedBy as integer,",
				"          LastEditedWhen as string,",
				"          Is_active as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> DIMorder",
				"SalesOrders select(mapColumn(",
				"          OrderID,",
				"          CustomerID,",
				"          SalespersonPersonID,",
				"          PickedByPersonID,",
				"          ContactPersonID,",
				"          BackorderOrderID,",
				"          OrderDate,",
				"          ExpectedDeliveryDate,",
				"          CustomerPurchaseOrderNumber,",
				"          PickingCompletedWhen,",
				"          LastEditedBy,",
				"          LastEditedWhen",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"SalesCustomers select(mapColumn(",
				"          CustomerID,",
				"          CustomerName,",
				"          BillToCustomerID,",
				"          CustomerCategoryID,",
				"          BuyingGroupID,",
				"          PhoneNumber,",
				"          DeliveryAddressLine1,",
				"          DeliveryAddressLine2,",
				"          DeliveryPostalCode,",
				"          PostalAddressLine1,",
				"          PostalAddressLine2,",
				"          PostalPostalCode,",
				"          LastEditedBy",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select1, select2 join(select1@CustomerID == select2@CustomerID,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join1",
				"join1 select(mapColumn(",
				"          OrderID,",
				"          CustomerID = select1@CustomerID,",
				"          CustomerName,",
				"          OrderDate,",
				"          ExpectedDeliveryDate,",
				"          CustomerPurchaseOrderNumber,",
				"          PhoneNumber,",
				"          DeliveryAddressLine1,",
				"          DeliveryAddressLine2,",
				"          DeliveryPostalCode",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select3",
				"select3, SalesOrderLines join(select3@OrderID == SalesOrderLines@OrderID,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join2",
				"join2 select(mapColumn(",
				"          OrderID = select3@OrderID,",
				"          CustomerID,",
				"          CustomerName,",
				"          PhoneNumber,",
				"          Description,",
				"          Quantity,",
				"          UnitPrice,",
				"          TaxRate,",
				"          OrderDate,",
				"          ExpectedDeliveryDate,",
				"          CustomerPurchaseOrderNumber,",
				"          DeliveryAddressLine1,",
				"          DeliveryAddressLine2,",
				"          DeliveryPostalCode",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select4",
				"select4 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          PersonID as string,",
				"          FullName as string,",
				"          PreferredName as string,",
				"          SearchName as string,",
				"          IsPermittedToLogon as string,",
				"          LogonName as string,",
				"          IsExternalLogonProvider as string,",
				"          HashedPassword as string,",
				"          IsSystemUser as string,",
				"          IsEmployee as string,",
				"          IsSalesperson as string,",
				"          UserPreferences as string,",
				"          PhoneNumber as string,",
				"          FaxNumber as string,",
				"          EmailAddress as string,",
				"          Photo as string,",
				"          CustomFields as string,",
				"          OtherLanguages as string,",
				"          LastEditedBy as string",
				"     ),",
				"     partitionFileNames:['WWI_order.csv'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> STGorder"
			]
		}
	}
}